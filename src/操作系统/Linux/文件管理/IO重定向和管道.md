# IO设备-标准输入输出
每个程序默认都会有三个标准 IO 设备，每个 IO 设备本质都是一个文件，每个 IO 设备在程序中都会分配一个fd（file descriptor，文件描述符）

+ 标准输入：fd-0，默认终端（终端也是一个文件）
+ 标准输出：fd-1，默认终端（终端也是一个文件）
+ 标准错误：fd-2，默认终端（终端也是一个文件），这个 IO 设备用于输出错误信息、警告信息、提示或询问信息

程序进程本质也是一系列文件，通常在 `/proc/{PID}/` 下，程序的 IO 设备在 `/proc/PID/fd/` 下，例如 `/proc/{PID}/fd/0` 就是标准输入

`/proc/$$/` 表示当前 Shell 进程的文件，其中 `$$` 是一个变量，表示当前 Shell 进程的PID

`/proc/self` 表示当前进程的文件，其中 `self` 表示当前进程的 PID，`self` 本质是一个软链接文件，链接当前进程的文件，多个进程并发时，进程每次访问 `/proc/self` 时，内核都会进行处理，保证它总是链接当前进程的文件

`/dev/stdin` 标准输入，本质是一个软链接，链接指向 `/proc/self/fd/0`，`/dev/stdout` 和 `/dev/stderr` 同理

当命令需要指定一个文件时，这时可以用 `-` 表示当前终端的标准输入输出，例如：`cat -`，表示从终端读取数据

```shell
# “-”的本质应该跟“tty”差不多
cat -
cat `tty`
```

# IO重定向
只能重定向到文件中

## 标准输出和标准错误的重定向
```shell
# 重定向标准输出，可以简写
echo > <文件>
echo 1> <文件>
# 重定向标准错误
echo 2> <文件>
# 重定向，文件可以是普通的文件，也可以是终端文件，例如：/dev/pts/0、/dev/pts/1，如果文件不存在，则会自动创建一个文件
# 注意：如果文件存在，则会覆盖内容，不会追加内容（如果当前命令多次输出，还是会追加的）



# 重定向标准输出和标准错误
echo &> <文件>
# 分开重定向
echo 1> <文件> 2> <文件>

# 将标准输出重定向到文件中，且将标准错误输出到跟标准输出一样的文件中去，&0表示标准输入，&1表示标准输出，&2表示标准错误
# 注意顺序会影响实际效果
<command> 1> <文件> 2>&1
# 标准错误重定向到旧的标准输出
<command> 2>&1 1> <文件>
```

追加内容

```shell
# 追加内容
echo >> <文件>
echo 1>> <文件>
echo 2>> <文件>
echo &>> <文件>
echo 1>> <文件> 2>> <文件>

# 这种写法，2>&1 不能写成 2>>&1
<command> 1>> <文件> 2>&1
<command> 2>&1 1>> <文件>
```

特殊用法

```shell
# 清空文件内容，或则创建一个空文件
> <文件>

# 丢弃输出，/dev/null是一个特殊文件，所有写入数据都将被丢弃
<command> > /dev/null

# 禁止覆盖文件内容（这是修改当前Shell的启动选项）
set -C
# 允许覆盖文件内容（这是修改当前Shell的启动选项）
set +C

# 强制覆盖，被禁止时也能覆盖
echo >| <文件>

# 只会重定向最后一个命令
<command> ; <command> > <文件>
# 所有命令都会重定向
( <command>; <command> ) > <文件>
{ <command>; <command>; } > <文件>
```

## 标准输入的重定向
```shell
# 标准输入的重定向，从文件读取内容，输入给命令
cat < <文件>

# 多行重定向，可以一次性输入多行数据，一次性提交并重定向到文件中去，减少IO操作
# 其中EOF表示文件结束符，但实际可以随便写，不过通常还是用EOF
# 按 Ctrl T 也能退出
cat <<EOF
cat > <文件> <<EOF
cat > <文件> <<XXX

# 注意：多行重定向的文本会被当成普通字符串，其中的变量引用、命令替换等语法都会被翻译
# 如果想防止这种情况发生，可以使用单引号将结束符包起来，如下：
cat <<'EOF'
```

# 管道
命令之间的重定向，两个命令是在不同的子 Shell 进程中执行

```shell
# 将前一个命令的标准输出，当作后一个命令的标准输入
# 注意：前一个命令必须支持标准输出，后一个命令必须支持标准输入
<command> | <command> | ...
echo 123 | cat
```

特殊用法

```shell
# 将前一个命令的标准输出和标准错误，当作后一个命令的标准输入
<command> 2>&1 | <command>
<command> |& <command>

# 管道中的-符号
# 解释：tar是压缩解压工具，前一个命令正常情况下会将/data文件夹压缩为data.tar，但是因为使用了管道，所以输出的压缩包可以通过管道传给下一个命令，下一个命令会将压缩包解压出来，因为data.tar这个名称实际并没有用到，所有可以省略为-符号
tar -cvf - /data | tar -xvf -
cat - | grep abc -
cat `tty` | grep abc -
```

